"use client";
'use strict';var chunkYF6EF5DN_cjs=require('./chunk-YF6EF5DN.cjs'),react=require('react'),jsxRuntime=require('react/jsx-runtime'),core=require('shiki/core'),javascript=require('shiki/engine/javascript'),q=require('shiki/themes/github-dark.mjs'),Q=require('shiki/themes/github-light.mjs');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var q__default=/*#__PURE__*/_interopDefault(q);var Q__default=/*#__PURE__*/_interopDefault(Q);var _=chunkYF6EF5DN_cjs.a("block","before:content-[counter(line)]","before:inline-block","before:[counter-increment:line]","before:w-6","before:mr-4","before:text-[13px]","before:text-right","before:text-muted-foreground/50","before:font-mono","before:select-none"),M=react.memo(({children:e,result:t,language:o,className:l,...i})=>{let n=react.useMemo(()=>({backgroundColor:t.bg,color:t.fg}),[t.bg,t.fg]);return jsxRuntime.jsx("pre",{className:chunkYF6EF5DN_cjs.a(l,"p-4 text-sm dark:bg-(--shiki-dark-bg)!"),"data-language":o,"data-streamdown":"code-block-body",style:n,...i,children:jsxRuntime.jsx("code",{className:"[counter-increment:line_0] [counter-reset:line]",children:t.tokens.map((r,a)=>jsxRuntime.jsx("span",{className:_,children:r.map((g,s)=>jsxRuntime.jsx("span",{className:"dark:bg-(--shiki-dark-bg)! dark:text-(--shiki-dark)!",style:{color:g.color,backgroundColor:g.bgColor,...g.htmlStyle},...g.htmlAttrs,children:g.content},s))},a))})})},(e,t)=>e.result===t.result&&e.language===t.language&&e.className===t.className);var v=({className:e,language:t,style:o,...l})=>jsxRuntime.jsx("div",{className:chunkYF6EF5DN_cjs.a("my-4 w-full overflow-hidden rounded-xl border border-border",e),"data-language":t,"data-streamdown":"code-block",style:{contentVisibility:"auto",containIntrinsicSize:"auto 200px",...o},...l});var D=({language:e,children:t})=>jsxRuntime.jsxs("div",{className:"flex items-center justify-between bg-muted/80 p-3 text-muted-foreground text-xs","data-language":e,"data-streamdown":"code-block-header",children:[jsxRuntime.jsx("span",{className:"ml-1 font-mono lowercase",children:e}),jsxRuntime.jsx("div",{className:"flex items-center gap-2",children:t})]});var p={"github-light":Q__default.default,"github-dark":q__default.default},O=e=>e in p;var W=chunkYF6EF5DN_cjs.c.dependencies.shiki.replace(/^\^/,""),K=5e3,A=e=>`${e}/shiki/${W}`,f=new Map,C=new Map,w=new Set,I=new Set,J=/JSON\.parse\(("(?:[^"\\]|\\.)*")\)/,y=/import\s+\w+\s+from\s+['"]\.\/([\w-]+)\.mjs['"]/g,T=new Set;async function X(e,t,o){let l=`${t}/${e}.mjs`,i=new AbortController,n=setTimeout(()=>i.abort(),o),r=await fetch(l,{signal:i.signal});if(clearTimeout(n),!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);let a=await r.text(),g=[],s=y.exec(a);for(;s!==null;)g.push(s[1]),s=y.exec(a);y.lastIndex=0;let d=a.match(J);if(!d)throw new Error("Could not find JSON.parse() in CDN response");let c=JSON.parse(d[1]);return {grammar:JSON.parse(c),dependencies:g}}async function R(e,t,o=K){if(t==null)return null;let i=`${A(t)}/langs`,n=`${i}/${e}`;if(f.has(n))return f.get(n);if(w.has(n)||T.has(n))return null;try{T.add(n);let r=await X(e,i,o);if(!r)throw new Error("Failed to load language");let{grammar:a,dependencies:g}=r,s=[];for(let d of g){let c=`${i}/${d}`;if(f.has(c)){let k=f.get(c);s.push(...k);continue}if(T.has(c)||w.has(c))continue;let m=await R(d,t,o);m&&s.push(...m);}return s.push(a),f.set(n,[a]),s}catch(r){w.add(n);let a=r instanceof Error?r.message:"Unknown error";return console.warn(`[Streamdown] Failed to load language "${e}" from CDN: ${a}`),null}finally{T.delete(n);}}async function j(e,t,o=K){if(t==null)return null;let i=`${A(t)}/themes`,n=`${i}/${e}`;if(C.has(n))return C.get(n);if(I.has(n))return null;try{let r=`${i}/${e}.mjs`,a=new AbortController,g=setTimeout(()=>a.abort(),o),s=await fetch(r,{signal:a.signal});if(clearTimeout(g),!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);let d=await s.text();try{let c=d.match(J);if(!c)throw new Error("Could not find JSON.parse() in CDN response");let m=JSON.parse(c[1]),k=JSON.parse(m);return C.set(n,k),k}catch(c){throw new Error(`Failed to parse theme: ${c instanceof Error?c.message:"Unknown error"}`)}}catch(r){I.add(n);let a=r instanceof Error?r.message:"Unknown error";return console.warn(`[Streamdown] Failed to load theme "${e}" from CDN: ${a}`),null}}var ee=javascript.createJavaScriptRegexEngine({forgiving:true}),B=new Map,x=new Map,u=new Map,te=(e,t)=>`${e}-${t[0]}-${t[1]}`,ne=(e,t,o)=>{let l=e.slice(0,100),i=e.length>100?e.slice(-100):"";return `${t}:${o[0]}:${o[1]}:${e.length}:${l}:${i}`};async function oe(e,t){if(O(e))return p[e];let o=await j(e,t);return o||(console.warn(`[Streamdown] Theme "${e}" not found. Falling back to ${e.includes("dark")?"github-dark":"github-light"}.`),e.includes("dark")?p["github-dark"]:p["github-light"])}async function re(e,t){if(chunkYF6EF5DN_cjs.f(e))return chunkYF6EF5DN_cjs.e[e];let o=await R(e,t);return o||console.warn(`[Streamdown] Language "${e}" not found in bundled languages or CDN. Falling back to plain text.`),o}var se=(e,t,o)=>{let l=te(e,t);if(B.has(l))return B.get(l);let i=(async()=>{let n=await re(e,o),r=n?[n]:["text"],a=await Promise.all(t.map(s=>oe(s,o)));return await core.createHighlighterCore({themes:a,langs:r,engine:ee})})();return B.set(l,i),i},L=({code:e,language:t,shikiTheme:o,cdnUrl:l,callback:i})=>{let n=ne(e,t,o);return x.has(n)?x.get(n):(i&&(u.has(n)||u.set(n,new Set),u.get(n).add(i)),se(t,o,l).then(r=>{let g=r.getLoadedLanguages().includes(t)?t:"text",s=r.codeToTokens(e,{lang:g,themes:{light:o[0],dark:o[1]}});x.set(n,s);let d=u.get(n);if(d){for(let c of d)c(s);u.delete(n);}}).catch(r=>{console.error("Failed to highlight code:",r),u.delete(n);}),null)};var Ie=({code:e,language:t,className:o,children:l,...i})=>{let{shikiTheme:n,cdnUrl:r}=react.useContext(chunkYF6EF5DN_cjs.j),a=react.useMemo(()=>({bg:"transparent",fg:"inherit",tokens:e.split(`
`).map(d=>[{content:d,color:"inherit",bgColor:"transparent",htmlStyle:{},offset:0}])}),[e]),[g,s]=react.useState(a);return react.useEffect(()=>{let d=L({code:e,language:t,shikiTheme:n,cdnUrl:r});if(d){s(d);return}s(a),L({code:e,language:t,shikiTheme:n,cdnUrl:r,callback:c=>{s(c);}});},[e,t,n,r,a]),jsxRuntime.jsx(chunkYF6EF5DN_cjs.b.Provider,{value:{code:e},children:jsxRuntime.jsxs(v,{language:t,children:[jsxRuntime.jsx(D,{language:t,children:l}),jsxRuntime.jsx(M,{className:o,language:t,result:g,...i})]})})};exports.CodeBlock=Ie;