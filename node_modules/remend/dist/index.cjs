'use strict';var p=/(\*\*)([^*]*?)$/,I=/(__)([^_]*?)$/,P=/(\*\*\*)([^*]*?)$/,B=/(\*)([^*]*?)$/,$=/(_)([^_]*?)$/,M=/(`)([^`]*?)$/,A=/(~~)([^~]*?)$/,c=/^[\s_~*`]*$/,k=/^[\s]*[-*+][\s]+$/,C=/[\p{L}\p{N}_]/u,S=/^```[^`\n]*```?$/,_=/^\*{4,}$/;var a=n=>{if(!n)return  false;let r=n.charCodeAt(0);return r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||r===95?true:C.test(n)},g=(n,r)=>{let e=false;for(let s=0;s<r;s+=1)n[s]==="`"&&n[s+1]==="`"&&n[s+2]==="`"&&(e=!e,s+=2);return e},O=(n,r)=>{let e=1;for(let s=r-1;s>=0;s-=1)if(n[s]==="]")e+=1;else if(n[s]==="["&&(e-=1,e===0))return s;return  -1},T=(n,r)=>{let e=1;for(let s=r+1;s<n.length;s+=1)if(n[s]==="[")e+=1;else if(n[s]==="]"&&(e-=1,e===0))return s;return  -1},d=(n,r)=>{let e=false,s=false;for(let i=0;i<n.length&&i<r;i+=1){if(n[i]==="\\"&&n[i+1]==="$"){i+=1;continue}n[i]==="$"&&(n[i+1]==="$"?(s=!s,i+=1,e=false):s||(e=!e));}return e||s},z=(n,r)=>{for(let e=r;e<n.length;e+=1){if(n[e]===")")return  true;if(n[e]===`
`)return  false}return  false},b=(n,r)=>{for(let e=r-1;e>=0;e-=1){if(n[e]===")")return  false;if(n[e]==="(")return e>0&&n[e-1]==="]"?z(n,r):false;if(n[e]===`
`)return  false}return  false},h=(n,r,e)=>{let s=0;for(let o=r-1;o>=0;o-=1)if(n[o]===`
`){s=o+1;break}let i=n.length;for(let o=r;o<n.length;o+=1)if(n[o]===`
`){i=o;break}let l=n.substring(s,i),t=0,f=false;for(let o of l)if(o===e)t+=1;else if(o!==" "&&o!=="	"){f=true;break}return t>=3&&!f};var Q=(n,r,e)=>{if(e!==" "&&e!=="	")return  false;let s=0;for(let i=r-1;i>=0;i-=1)if(n[i]===`
`){s=i+1;break}for(let i=s;i<r;i+=1)if(n[i]!==" "&&n[i]!=="	")return  false;return  true},Y=(n,r,e,s)=>e==="\\"||n.includes("$")&&d(n,r)?true:e!=="*"&&s==="*"?(r<n.length-2?n[r+2]:"")!=="*":!!(e==="*"||e&&s&&a(e)&&a(s)||Q(n,r,s)),U=n=>{let r=0,e=n.length;for(let s=0;s<e;s+=1){if(n[s]!=="*")continue;let i=s>0?n[s-1]:"",l=s<e-1?n[s+1]:"";Y(n,s,i,l)||(r+=1);}return r},j=(n,r,e,s)=>!!(e==="\\"||n.includes("$")&&d(n,r)||b(n,r)||e==="_"||s==="_"||e&&s&&a(e)&&a(s)),q=n=>{let r=0,e=n.length;for(let s=0;s<e;s+=1){if(n[s]!=="_")continue;let i=s>0?n[s-1]:"",l=s<e-1?n[s+1]:"";j(n,s,i,l)||(r+=1);}return r},G=n=>{let r=0,e=0;for(let s=0;s<n.length;s+=1)n[s]==="*"?e+=1:(e>=3&&(r+=Math.floor(e/3)),e=0);return e>=3&&(r+=Math.floor(e/3)),r},J=(n,r,e)=>{if(!r||c.test(r))return  true;let i=n.substring(0,e).lastIndexOf(`
`),l=i===-1?0:i+1,t=n.substring(l,e);return k.test(t)&&r.includes(`
`)?true:h(n,e,"*")},N=n=>{let r=n.match(p);if(!r)return n;let e=r[2],s=n.lastIndexOf(r[1]);return g(n,s)||J(n,e,s)?n:(n.match(/\*\*/g)||[]).length%2===1?`${n}**`:n},V=(n,r,e)=>{if(!r||c.test(r))return  true;let i=n.substring(0,e).lastIndexOf(`
`),l=i===-1?0:i+1,t=n.substring(l,e);return k.test(t)&&r.includes(`
`)?true:h(n,e,"_")},w=n=>{let r=n.match(I);if(!r)return n;let e=r[2],s=n.lastIndexOf(r[1]);return g(n,s)||V(n,e,s)?n:(n.match(/__/g)||[]).length%2===1?`${n}__`:n},X=n=>{for(let r=0;r<n.length;r+=1)if(n[r]==="*"&&n[r-1]!=="*"&&n[r+1]!=="*"&&n[r-1]!=="\\"&&!d(n,r)){let e=r>0?n[r-1]:"",s=r<n.length-1?n[r+1]:"";if(e&&s&&a(e)&&a(s))continue;return r}return  -1},L=n=>{if(!n.match(B))return n;let e=X(n);if(e===-1||g(n,e))return n;let s=n.substring(e+1);return !s||c.test(s)?n:U(n)%2===1?`${n}*`:n},W=n=>{for(let r=0;r<n.length;r+=1)if(n[r]==="_"&&n[r-1]!=="_"&&n[r+1]!=="_"&&n[r-1]!=="\\"&&!d(n,r)&&!b(n,r)){let e=r>0?n[r-1]:"",s=r<n.length-1?n[r+1]:"";if(e&&s&&a(e)&&a(s))continue;return r}return  -1},Z=n=>{let r=n.length;for(;r>0&&n[r-1]===`
`;)r-=1;if(r<n.length){let e=n.slice(0,r),s=n.slice(r);return `${e}_${s}`}return `${n}_`},x=n=>{if(!n.endsWith("**"))return null;let r=n.slice(0,-2);if((r.match(/\*\*/g)||[]).length%2!==1)return null;let s=r.indexOf("**"),i=W(r);return s!==-1&&i!==-1&&s<i?`${r}_**`:null},R=n=>{if(!n.match($))return n;let e=W(n);if(e===-1||g(n,e))return n;let s=n.substring(e+1);if(!s||c.test(s))return n;if(q(n)%2===1){let l=x(n);return l!==null?l:Z(n)}return n},nn=n=>{let r=(n.match(/\*\*/g)||[]).length,e=U(n);return r%2===0&&e%2===0},rn=(n,r,e)=>!r||c.test(r)||g(n,e)?true:h(n,e,"*"),E=n=>{if(_.test(n))return n;let r=n.match(P);if(!r)return n;let e=r[2],s=n.lastIndexOf(r[1]);return rn(n,e,s)?n:G(n)%2===1?nn(n)?n:`${n}***`:n};var m=(n,r)=>{let e=false,s=false;for(let i=0;i<r;i+=1){if(n.substring(i,i+3)==="```"){s=!s,i+=2;continue}!s&&n[i]==="`"&&(e=!e);}return e||s},en=(n,r)=>{let e=n.substring(r,r+3)==="```",s=r>0&&n.substring(r-1,r+2)==="```",i=r>1&&n.substring(r-2,r+1)==="```";return e||s||i},H=n=>{let r=0;for(let e=0;e<n.length;e+=1)n[e]==="`"&&!en(n,e)&&(r+=1);return r};var sn=n=>!n.match(S)||n.includes(`
`)?null:n.endsWith("``")&&!n.endsWith("```")?`${n}\``:n,tn=n=>(n.match(/```/g)||[]).length%2===1,D=n=>{let r=sn(n);if(r!==null)return r;let e=n.match(M);if(e&&!tn(n)){let s=e[2];if(!s||c.test(s))return n;if(H(n)%2===1)return `${n}\``}return n};var ln=(n,r)=>r>=2&&n.substring(r-2,r+1)==="```"||r>=1&&n.substring(r-1,r+2)==="```"||r<=n.length-3&&n.substring(r,r+3)==="```",on=n=>{let r=0,e=false;for(let s=0;s<n.length-1;s+=1)n[s]==="`"&&!ln(n,s)&&(e=!e),!e&&n[s]==="$"&&n[s+1]==="$"&&(r+=1,s+=1);return r},cn=n=>{let r=n.indexOf("$$");return r!==-1&&n.indexOf(`
`,r)!==-1&&!n.endsWith(`
`)?`${n}
$$`:`${n}$$`},F=n=>on(n)%2===0?n:cn(n);var an=(n,r)=>{if(n.substring(r+2).includes(")"))return null;let s=O(n,r);if(s===-1||m(n,s))return null;let i=s>0&&n[s-1]==="!",l=i?s-1:s,t=n.substring(0,l);if(i)return t;let f=n.substring(s+1,r);return `${t}[${f}](streamdown:incomplete-link)`},un=(n,r)=>{let e=r>0&&n[r-1]==="!",s=e?r-1:r;if(!n.substring(r+1).includes("]")){let t=n.substring(0,s);return e?t:`${n}](streamdown:incomplete-link)`}if(T(n,r)===-1){let t=n.substring(0,s);return e?t:`${n}](streamdown:incomplete-link)`}return null},v=n=>{let r=n.lastIndexOf("](");if(r!==-1&&!m(n,r)){let e=an(n,r);if(e!==null)return e}for(let e=n.length-1;e>=0;e-=1)if(n[e]==="["&&!m(n,e)){let s=un(n,e);if(s!==null)return s}return n};var fn=/^-{1,2}$/,gn=/^[\s]*-{1,2}[\s]+$/,dn=/^={1,2}$/,hn=/^[\s]*={1,2}[\s]+$/,K=n=>{if(!n||typeof n!="string")return n;let r=n.lastIndexOf(`
`);if(r===-1)return n;let e=n.substring(r+1),s=n.substring(0,r),i=e.trim();if(fn.test(i)&&!e.match(gn)){let t=s.split(`
`).at(-1);if(t&&t.trim().length>0)return `${n}\u200B`}if(dn.test(i)&&!e.match(hn)){let t=s.split(`
`).at(-1);if(t&&t.trim().length>0)return `${n}\u200B`}return n};var y=n=>{let r=n.match(A);if(r){let e=r[2];if(!e||c.test(e))return n;if((n.match(/~~/g)||[]).length%2===1)return `${n}~~`}return n};var u=n=>n!==false,mn=(n,r)=>{if(!n||typeof n!="string")return n;let e=n.endsWith(" ")&&!n.endsWith("  ")?n.slice(0,-1):n;if(u(r==null?void 0:r.setextHeadings)&&(e=K(e)),u(r==null?void 0:r.links)||u(r==null?void 0:r.images)){let s=v(e);if(s.endsWith("](streamdown:incomplete-link)"))return s;e=s;}return u(r==null?void 0:r.boldItalic)&&(e=E(e)),u(r==null?void 0:r.bold)&&(e=N(e)),u(r==null?void 0:r.italic)&&(e=w(e),e=L(e),e=R(e)),u(r==null?void 0:r.inlineCode)&&(e=D(e)),u(r==null?void 0:r.strikethrough)&&(e=y(e)),u(r==null?void 0:r.katex)&&(e=F(e)),e},Fn=mn;module.exports=Fn;