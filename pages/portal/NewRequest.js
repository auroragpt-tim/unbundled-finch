import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Checkbox } from "@/components/ui/checkbox";
import { useAuth } from "@/contexts/AuthContext";
import { useState } from "react";
import { Upload, CheckCircle2, AlertCircle } from "lucide-react";
export default function NewRequest() {
    const { user } = useAuth();
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [isSuccess, setIsSuccess] = useState(false);
    const [error, setError] = useState(null);
    const handleSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        setError(null);
        const form = e.currentTarget;
        const formData = new FormData(form);
        // Add user email if not present
        if (user?.email && !formData.get("requester-email")) {
            formData.append("requester-email", user.email);
        }
        try {
            const response = await fetch("https://formspree.io/f/meeeqkyp", {
                method: "POST",
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            });
            if (response.ok) {
                setIsSuccess(true);
                form.reset();
            }
            else {
                const data = await response.json();
                setError(data.error || "Something went wrong. Please try again.");
            }
        }
        catch (err) {
            setError("Failed to submit form. Please check your connection.");
        }
        finally {
            setIsSubmitting(false);
        }
    };
    if (isSuccess) {
        return (_jsx("div", { className: "max-w-3xl mx-auto", children: _jsx(Card, { className: "border-border shadow-sm", children: _jsxs(CardContent, { className: "pt-6 text-center py-16", children: [_jsx("div", { className: "flex justify-center mb-6", children: _jsx("div", { className: "h-16 w-16 bg-green-100 rounded-full flex items-center justify-center", children: _jsx(CheckCircle2, { className: "h-8 w-8 text-green-600" }) }) }), _jsx("h2", { className: "text-2xl font-bold mb-2", children: "Request Submitted Successfully" }), _jsxs("p", { className: "text-muted-foreground mb-8 max-w-md mx-auto", children: ["Your work order has been received. We will review the details and get back to you shortly at ", user?.email, "."] }), _jsx(Button, { onClick: () => setIsSuccess(false), variant: "outline", children: "Submit Another Request" })] }) }) }));
    }
    return (_jsxs("div", { className: "max-w-4xl mx-auto", children: [_jsxs("div", { className: "mb-8", children: [_jsx("h1", { className: "text-3xl font-bold tracking-tight mb-2", children: "New Work Order" }), _jsx("p", { className: "text-muted-foreground", children: "Submit a new document processing request." })] }), _jsxs(Card, { className: "border-border shadow-sm", children: [_jsx(CardHeader, { className: "border-b border-border bg-secondary/5", children: _jsx(CardTitle, { className: "text-lg font-medium", children: "Project Details" }) }), _jsx(CardContent, { className: "p-6", children: _jsxs("form", { onSubmit: handleSubmit, className: "space-y-8", children: [_jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-sm font-bold uppercase tracking-wider text-muted-foreground", children: "Project Information" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "project-name", children: "Project Name" }), _jsx(Input, { id: "project-name", name: "project-name", placeholder: "Enter project name", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "project-number", children: "Project Number" }), _jsx(Input, { id: "project-number", name: "project-number", placeholder: "Enter project number", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "client-name", children: "Client/Customer Name" }), _jsx(Input, { id: "client-name", name: "client-name", placeholder: "Enter client name", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "contact-phone", children: "Contact Phone Number" }), _jsx(Input, { id: "contact-phone", name: "contact-phone", placeholder: "Enter phone number", required: true })] })] })] }), _jsx("div", { className: "h-px bg-border" }), _jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-sm font-bold uppercase tracking-wider text-muted-foreground", children: "Order Details" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "change-order-number", children: "Order Number (if applicable)" }), _jsx(Input, { id: "change-order-number", name: "change-order-number", placeholder: "Enter order number" })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "date-of-request", children: "Date of Request" }), _jsx(Input, { id: "date-of-request", name: "date-of-request", type: "date", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "requested-by", children: "Requested By" }), _jsx(Input, { id: "requested-by", name: "requested-by", defaultValue: user?.user_metadata?.full_name, placeholder: "Enter requester name", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "requester-email", children: "Requester Email" }), _jsx(Input, { id: "requester-email", name: "requester-email", type: "email", defaultValue: user?.email, placeholder: "Enter email", required: true })] }), _jsxs("div", { className: "col-span-full space-y-2", children: [_jsx(Label, { htmlFor: "change-description", children: "Description of Request" }), _jsx(Textarea, { id: "change-description", name: "change-description", placeholder: "Provide details about the requested change", className: "min-h-[100px]", required: true })] }), _jsxs("div", { className: "col-span-full space-y-2", children: [_jsx(Label, { htmlFor: "reason-for-change", children: "Reason for Change" }), _jsx(Textarea, { id: "reason-for-change", name: "reason-for-change", placeholder: "e.g., 'Client request', 'Budget adjustments', etc.", className: "min-h-[80px]", required: true })] })] })] }), _jsx("div", { className: "h-px bg-border" }), _jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-sm font-bold uppercase tracking-wider text-muted-foreground", children: "Attachments" }), _jsxs("div", { className: "border-2 border-dashed border-border rounded-lg p-8 text-center hover:bg-secondary/5 transition-colors cursor-pointer relative", children: [_jsx("input", { type: "file", name: "attachment", className: "absolute inset-0 w-full h-full opacity-0 cursor-pointer", multiple: true }), _jsxs("div", { className: "flex flex-col items-center gap-2", children: [_jsx("div", { className: "h-10 w-10 bg-secondary rounded-full flex items-center justify-center", children: _jsx(Upload, { className: "h-5 w-5 text-muted-foreground" }) }), _jsx("div", { className: "text-sm font-medium", children: "Click to upload or drag and drop" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "PDF, DOCX, JPG up to 10MB" })] })] })] }), _jsx("div", { className: "h-px bg-border" }), _jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-sm font-bold uppercase tracking-wider text-muted-foreground", children: "Cost and Schedule Impact" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "additional-cost", children: "Estimated Additional Cost" }), _jsx(Input, { id: "additional-cost", name: "additional-cost", placeholder: "Enter estimated additional cost" })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "adjusted-total-cost", children: "Adjusted Total Cost" }), _jsx(Input, { id: "adjusted-total-cost", name: "adjusted-total-cost", placeholder: "Enter adjusted total cost" })] }), _jsxs("div", { className: "col-span-full space-y-2", children: [_jsx(Label, { htmlFor: "schedule-impact", children: "Impact on Schedule" }), _jsx(Textarea, { id: "schedule-impact", name: "schedule-impact", placeholder: "Describe the schedule impact, if any" })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "new-completion-date", children: "New Completion Date" }), _jsx(Input, { id: "new-completion-date", name: "new-completion-date", type: "date" })] })] })] }), _jsx("div", { className: "h-px bg-border" }), _jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-sm font-bold uppercase tracking-wider text-muted-foreground", children: "Approval and Acknowledgment" }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "approval-by", children: "Approval By (Name)" }), _jsx(Input, { id: "approval-by", name: "approval-by", placeholder: "Enter approver name", required: true })] }), _jsxs("div", { className: "space-y-2", children: [_jsx(Label, { htmlFor: "approval-date", children: "Approval Due Date" }), _jsx(Input, { id: "approval-date", name: "approval-date", type: "date", required: true })] }), _jsxs("div", { className: "col-span-full space-y-2", children: [_jsx(Label, { htmlFor: "comments-notes", children: "Comments/Notes" }), _jsx(Textarea, { id: "comments-notes", name: "comments-notes", placeholder: "Add any additional remarks (optional)" })] })] })] }), _jsx("div", { className: "h-px bg-border" }), _jsx("div", { className: "space-y-4", children: _jsxs("div", { className: "flex items-start space-x-3", children: [_jsx(Checkbox, { id: "acknowledge-terms", name: "acknowledge-terms", required: true }), _jsxs("div", { className: "grid gap-1.5 leading-none", children: [_jsx(Label, { htmlFor: "acknowledge-terms", className: "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70", children: "Acknowledgment of Terms" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "I understand and agree to the changes outlined above." })] })] }) }), error && (_jsxs("div", { className: "bg-destructive/10 text-destructive text-sm p-3 rounded-md flex items-center gap-2", children: [_jsx(AlertCircle, { className: "h-4 w-4" }), error] })), _jsx("div", { className: "flex justify-end pt-4", children: _jsx(Button, { type: "submit", size: "lg", className: "w-full md:w-auto", disabled: isSubmitting, children: isSubmitting ? "Submitting..." : "Submit Work Order" }) })] }) })] })] }));
}
